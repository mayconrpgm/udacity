Análise sobre vinhos tintos e quais propriedades químicas influenciam a qualidade por Maycon Pinheiro Queiros
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Carregue aqui todos os pacotes utilizados 
# na sua análise realizada neste arquivo fonte.

# Note que o parâmetro "echo" foi definido como FALSE neste código.
# Isso previne que o código apresente resultados formatados em HTML.
# Você deve definir echo=FALSE para todos os blocos de código no seu arquivo.

library(ggplot2)
library(RColorBrewer)
library(gridExtra)
library(GGally)
library(reshape)
library(ggcorrplot)
library(dplyr)
```

```{r echo=FALSE, Load_the_Data}
# Carregamento dos dados
redWines <- read.csv('wineQualityReds.csv')

# Removendo a variável "X" já que é apenas um identificador numérico sequencial
redWines <- subset(redWines, select = -c(X))
```

# Seção de Gráficos Univariados
```{r echo=FALSE, Univariate_Plots}
dim(redWines)
```

O conjunto de dados é composto por 12 variáveis com 1599 observações.

```{r echo=FALSE, message=FALSE, warning=FALSE}
str(redWines)
```

Todas são variáveis númericas, sendo "quality" a única com valores inteiros e as outras são do tipo ponto flutuante.

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(redWines)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
redWines.molten <- melt(redWines)

ggplot(aes(x = factor(variable), y = value), data = redWines.molten) + 
  geom_boxplot() + 
  facet_wrap(~variable, scale="free")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = value), data = redWines.molten) + 
  geom_histogram(binwidth = 0.1) + 
  facet_wrap(~variable, scale="free")
```

Primeiramente, analisarei a estrutura geral e distribuição de cada variável. Observando os boxplots, podemos ver que muitas das variáveis apresentam outliers, por exemplo, as variáveis *residual.sugar*, *chlorides* e *sulphates*. A variável *density* tem um comportamento interessante, a amplitude dos valores é bem pequena, concentrados em uma pequena faixa de valores, algo similar aconcete com a variável *sulphates*, os valores estão concentrados em uma pequena faixa, porém temos outliers que estão bem acima da média/mediana.

Observando os histogramas, é possível ver de início algumas variáveis com distribuições normais ou próximas disso, sendo elas *fixed.acidity*, *volatile.acidity*, *pH* e *quality*.

Outras variáveis tem uma visível distribuição distorcida à direita, como *citric.acid* e *alcohol*. O *residual.sugar* também aparenta isso, mas pode ser devido aos outliers presentes mais à direita do gráfico.

A variável *free.sulfur.dioxide* possui valores bem esparsos assim como *total.sulfur.dioxide*, esta última com valores concentrados em certas faixas. *density* parece ter uma distribuição homogênea, embora isso possa ser devido ao tamanho definido para o bin, já que os valores dessa variável se alteram em uma escala inferior a 0.1.

Agora vamos observar com mais detalhes algumas das variáveis.

```{r echo=FALSE, message=FALSE, warning=FALSE}
qualityMedian <- median(redWines$quality)

ggplot(aes(x = quality), data = redWines) + 
  geom_histogram(binwidth = 1) + #Ajustando a largura do bin para 1 já que esta é uma variávei inteira
  scale_x_continuous(breaks = seq(0,10,1)) + 
  geom_vline(aes(xintercept = median(redWines$quality), color="Mediana"), linetype="dashed", size = 1)
```

A variável *quality* apresenta uma distribuição normal como vimos anteriormente, embora e curva é bem estreita, a concertração maior é entre as notas 5 e 6. É interessante perceber que não há nenhum vinho com nota inferior à 3 e nem superior à 8. Metade dos vinhos possui nota superior a 6.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = density), data = redWines) + 
  geom_histogram(binwidth = 0.001) 
```

Reajustando a largura dos bins para a variável *density*, vemos que ela possui uma distribuição normal, talvez seja interessante aplicar algun tipo de transformação para afastar mais os valores entre si e facilitar a identificação de correlações.

```{r}
ggplot(aes(x = residual.sugar), data = redWines) + 
  geom_histogram(binwidth = 0.1) 
```
Como vimos anteriormente, há uma distorção a direita no histograma de *residual.sugar* (quanto mais alto o valor desta variável, mais doce é o vinho), talvez ao remover valores extremos, estaremos mais próximos de uma distribuição normal.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = residual.sugar), data = redWines) + 
  geom_histogram(binwidth = 0.1) + 
  xlim(min(redWines$residual.sugar), quantile(redWines$residual.sugar, .95)) +
  ggtitle("Histograma de residual.sugar (95º Percentil)")
```
O gráfico acima é um zoom considerando apenas as observações dentro do 95º percentil da variável *residual.sugar*, vemos que ainda há uma distorção significativa à direita.

```{r echo=FALSE, message=FALSE, warning=FALSE}
redWines.hq <- subset(redWines, quality >= 7)

h1 <- ggplot(aes(x = alcohol), data = redWines) + 
  geom_histogram(binwidth = 0.1) + 
  ggtitle("Histograma de alcohol", "Todos os vinhos")

h2 <- ggplot(aes(x = alcohol), data = redWines.hq) + 
  geom_histogram(binwidth = 0.1) + 
  ggtitle("Histograma de alcohol", "vinhos com nota igual ou superior à 7")

grid.arrange(h1, h2, ncol = 2)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
h3 <- ggplot(aes(x = residual.sugar), data = redWines) + 
  geom_histogram(binwidth = 0.1) + 
  ggtitle("Histograma de residual.sugar", "Todos os vinhos")

h4 <- ggplot(aes(x = residual.sugar), data = redWines.hq) + 
  geom_histogram(binwidth = 0.1)  + 
  ggtitle("Histograma de residual.sugar", "vinhos com nota igual ou superior à 7")

grid.arrange(h3, h4, ncol = 2)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
h5 <- ggplot(aes(x = volatile.acidity), data = redWines) + 
  geom_histogram(binwidth = 0.1) + 
  ggtitle("Histograma de volatile.acidity", "Todos os vinhos")

h6 <- ggplot(aes(x = volatile.acidity), data = redWines.hq) + 
  geom_histogram(binwidth = 0.1)  + 
  ggtitle("Histograma de volatile.acidity", "vinhos com nota igual ou superior à 7")

grid.arrange(h5, h6, ncol = 2)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
h7 <- ggplot(aes(x = free.sulfur.dioxide), data = redWines) + 
  geom_histogram(binwidth = 1) + 
  ggtitle("Histograma de free.sulfur.dioxide", "Todos os vinhos")

h8 <- ggplot(aes(x = free.sulfur.dioxide), data = redWines.hq) + 
  geom_histogram(binwidth = 1)  + 
  ggtitle("Histograma de free.sulfur.dioxide", "vinhos com nota igual ou superior à 7")

grid.arrange(h7, h8, ncol = 2)
```


Vejamos algumas características segmentando vinhos de qualidade igual ou superior à 7 e como eles se comparam aos vinhos no geral. Observamos as variáveis *alcohol*, *residual.sugar*, *volatile.acidity* e *free.sulfur.dioxide*. Ao que parece, o álcool influencia mais na qualidade quando em valores mais extremos tanto para cima quando para baixo, os vinhos de alta qualidade apresentam uma distribuição um pouco mais uniforme. Já com relação ao açúcar, vinhos mais doces foram considerados inferiores. A acidez volátil parece interferir em níveis mais altos assim como dióxide de enxofre.

```{r echo=FALSE, message=FALSE, warning=FALSE}
redWines.outliers <- redWines

for(i in c("fixed.acidity","volatile.acidity","citric.acid","residual.sugar","chlorides","free.sulfur.dioxide","total.sulfur.dioxide","density","pH","sulphates","alcohol")) {
  Q1 = quantile(redWines.outliers[, i], .25)
  Q3 = quantile(redWines.outliers[, i], .75)

  step = (Q3 - Q1) * 1.5
  
  redWines.outliers[, paste(i, 'outlier', sep=".")] <- ifelse(redWines.outliers[, i] > Q3 + step | redWines.outliers[, i] < Q1 - step, 1, 0)
}

redWines.outliers$outlier_count <- 
                            redWines.outliers$fixed.acidity.outlier + 
                            redWines.outliers$volatile.acidity.outlier + 
                            redWines.outliers$citric.acid.outlier + 
                            redWines.outliers$residual.sugar.outlier + 
                            redWines.outliers$chlorides.outlier + 
                            redWines.outliers$free.sulfur.dioxide.outlier + 
                            redWines.outliers$total.sulfur.dioxide.outlier + 
                            redWines.outliers$density.outlier + 
                            redWines.outliers$pH.outlier + 
                            redWines.outliers$sulphates.outlier + 
                            redWines.outliers$alcohol.outlier

ggplot(aes(x = outlier_count), data = redWines.outliers) + 
  geom_histogram(binwidth = 1)
```
Por fim, vamos detectar se existem muitos outliers dentre as variáveis analisadas, utilizei o método "Turkey's fences" para determinar se uma observação de uma das variáveis é ou não um outlier. Também criei uma variável que indica a contagem de variáveis de um vinho que foram identificadas como outliers

O gráfico acima aponta a quantidade de vinhos de acordo com quantas variáveis com valores aberrantes ele possui. Vemos que a grande maioria não apresenta nenhuma variável outlier, observaremos mais adiante se há uma correlação entre a contagem de outliers e a qualidade do vinho.

# Análise Univariada

### Qual é a estrutura do conjunto de dados?

O conjunto de dados analisado é composto por 12 variáveis com 1599 observações.

Todas são variáveis númericas, sendo "quality" a única com valores inteiros e as outras são do tipo ponto flutuante.

### Quais são os principais atributos de interesse deste conjunto de dados?

A variável *quality* será muito importante, ela servirá de variável dependente em que iremos avaliar como as outras variáveis interferem nela. Ela varia numa escala de 0 a 10 e é interessante ver que não há vinhos com qualidade inferior a 3 ou superior a 8.

A variável *density* possui uma amplitude de valores muito baixa. Outras já tem amplitudes maiores como *free.sulfur.dioxide* e *total.sulfur.dioxide*

O nível de açúcar, o teor alcoólico paracem ser relevantes para determinar a qualidade. 

### Quais outros atributos você acha que podem lhe auxiliar na investigação destes atributos de interesse?

Além disso, a acidez volátil (contribui para o aroma de vinagre) e o equilíbrio das características do vinho também deve ser importante, se alguma propriedade se sobresai demais, ela pode interferir na qualidade [1].

O volume de dióxido de enxofre parece interferir na qualidade quando em grande quantidade.

Fontes:
[1]https://www.clubedosvinhos.com.br/qualidade-de-um-vinho/

### Você criou novas variáveis a partir dos atributos existentes no conjunto de dados?

Sim, criei novas variáveis para cada uma das variáveis com excessão de *quality* para indicar se o valor observado é ou não um outlier.

Também criei outra variável que indica a quantidade de variáveis com valores aberrantes para o vinho observado.

### Dos atributos investigados, distribuições incomuns foram encontradas? Você aplicou operações nos dados para limpá-los, ajustá-los ou mudar a forma dos dados? Se sim, por quê?

Os atributos com comportamento mais incomuns foram *free.sulfur.dioxide*, *total.sulfur.dioxide* e *density*.

# Seção de Gráficos Bivariados
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggpairs(redWines)
```
```{r echo=FALSE}
ggcorrplot(cor(redWines), type = "lower",
   lab = TRUE)
```
Vamos começar por analisar se existem correlações existentes entre as variáveis utilizando matrizes de correlação. Em termos de correlação com qualidade, as únicas variáveis que tem uma correlação mais relevante são *alcohol* (correlação positiva) e *volatile.acidity* (correlação negativa) e mesmo assim são correlações fracas. Há correlações mais fortes entre as outras características, como entre *density* e *fixed.acidity* e *pH* e as variáveis relacionadas à acidez (sendo uma correlação mais óbvia, já que quanto menor o pH é esperado um maior teor de acidez).

Isso não que dizer que as outras variáveis não tem influência sobre a qualidade, é possível que as correlações não sejam lineares.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = alcohol, y = quality), data = redWines) + 
  geom_jitter(alpha = .1) +
  geom_smooth(color = "red", method = "lm")
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = volatile.acidity, y = quality), data = redWines) + 
  geom_jitter(alpha = .1) + 
  geom_smooth(color = "red", method = "lm")
```
Acima vemos os gráficos de dispersão apresentando as variáveis com maior correlação, *alcohol* e *volatile.acidity*. Podemos confirmar que existe uma correlação, a linhas de tendência mostram que conforme o teor alcoólico aumenta a qualidade acompanha, porém a distribuição dos pontos é esparsa, ou seja, olhar apenas o teor alcoólico não é o suficiente para dizer se o vinho é bom ou não. A acidez volátil possui um comportamento similar, mas possui correlação um pouco mais forte e no sentino negativo.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = residual.sugar, y = quality), data = redWines) + 
  geom_jitter(alpha = .1) + 
  geom_vline(aes(xintercept = quantile(residual.sugar, .75) + (IQR(residual.sugar) * 1.5), color="red"), linetype="dashed", size = .5) +
  theme(legend.position = "none")
```
Observando o gráfico de dispersão entre a quantidade de açúcar e a qualidade, vemos que o que foi observado anteriormente no histograma de *residual.sugar* fica um pouco mais evidente, a linha vertical tracejada indica o limite onde a quantidade de açúcar é considerada um outlier dentre os vinhos observados, vinhos mais doces não são avaliados como de alta qualidade, mas é interessante notar uma certa curva em que a qualidade sobe um pouco com o aumento do açúcar e depois desce quando esta quantidade é muito alta.

```{r echo=FALSE, message=FALSE, warning=FALSE}
sugarUpperFence <- quantile(redWines$residual.sugar, .75) + (IQR(redWines$residual.sugar) * 1.5)


ggplot(aes(x = residual.sugar, y = quality), data = subset(redWines, residual.sugar < sugarUpperFence)) + 
  geom_jitter(alpha = .1) + 
  geom_smooth(color = "red", method = "lm")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = free.sulfur.dioxide, y = quality), data = redWines) + 
  geom_jitter(alpha = .1)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
rw.outlier_group <- redWines.outliers %>% 
  group_by(outlier_count) %>%
  summarise(quality_mean = mean(quality),
            quality_median = median(quality),
            n = n()) %>%
  arrange(outlier_count)

ggplot(aes(x = outlier_count), data = rw.outlier_group) + 
  geom_line(aes(y = quality_mean, colour = "quality_mean")) + 
  geom_line(aes(y = quality_median, colour = "quality_median")) 
```


# Análise Bivariada

### Discuta sobre alguns dos relacionamentos observados nesta parte da investigação. Como os atributos de interesse variaram no conjunto de dados?

### Você observou algum relacionamento interessante entre os outros atributos (os que não são de interesse)?

### Qual foi o relacionamento mais forte encontrado?




# Seção de Gráficos Multivariados

```{r echo=FALSE, Multivariate_Plots}

```

# Análise Multivariada

### Discuta sobre os relacionamentos observados nesta parte da investigação. Quais atributos que fortaleceram os demais na observação das variáveis de interesse?

### Interações surpreendentes e/ou interessantes foram encontradas entre os atributos?

### OPCIONAL: Modelos foram criados usando este conjunto de dados? Discuta sobre os pontos fortes e as limitações do seu modelo.

------

# Gráficos Finais e Sumário

### Primeiro Gráfico
```{r echo=FALSE, Plot_One}

```

### Descrição do Primeiro Gráfico


### Segundo Gráfico
```{r echo=FALSE, Plot_Two}

```

### Descrição do Segundo Gráfico


### Terceiro Gráfico
```{r echo=FALSE, Plot_Three}

```

### Descrição do Terceiro Gráfico

------

# Reflexão


